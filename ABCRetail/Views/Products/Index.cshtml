@model IEnumerable<ABCRetail.Models.Product>
@using System.Globalization
@{
    ViewData["Title"] = "Products";
    var q = ViewBag.Query as string;
    var count = Model?.Count() ?? 0;
    var za = new CultureInfo("en-ZA");
}

<section class="container py-4 text-white">
    @if (TempData["err"] != null)
    {
        <div class="alert alert-warning">@TempData["err"]</div>
    }

    <div class="d-flex flex-column flex-lg-row gap-3 align-items-lg-center justify-content-between mb-3">
        <div>
            <h1 class="display-6 mb-0"><i class="bi bi-box-seam-fill me-2"></i>Product Details</h1>
            <div class="text-muted-2">Manage your product catalog</div>
        </div>
        <div class="d-flex gap-2">
            <form class="d-flex" method="get" asp-action="Index">
                <input class="form-control me-2" name="q" value="@(q ?? "")" placeholder="Search name or SKU…" />
                <button class="btn btn-ghost" type="submit"><i class="bi bi-search"></i></button>
            </form>
            <a asp-action="Create" class="btn cta-btn"><i class="bi bi-plus-circle me-2"></i>Add Product</a>
        </div>
    </div>

    <div class="d-flex gap-3 mb-3">
        <div class="stat">
            <div class="num">@count</div>
            <div class="label"><i class="bi bi-box-seam me-1"></i>Total</div>
        </div>
    </div>

    @if (count == 0)
    {
        <div class="feature-card p-4 text-center">
            <i class="bi bi-box-seam display-6 d-block mb-2"></i>
            <div class="fs-5">No products yet</div>
            <div class="text-muted-2 mb-3">Click “Add Product” to create your first item.</div>
            <a asp-action="Create" class="btn cta-btn"><i class="bi bi-plus-lg me-2"></i>Add Product</a>
        </div>
    }
    else
    {
        <div class="table-responsive">
            <table class="table align-middle text-white">
                <thead>
                    <tr>
                        <th>Product</th>
                        <th>Stock Keeping Unit</th>
                        <th class="text-end">Price</th>
                        <th>Image</th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var p in Model)
                    {
                        <tr class="table-row-elevated">
                            <td class="fw-semibold">@p.Name</td>
                            <td><span class="sku-badge">@p.StockKeepingUnit</span></td>
                            <td class="text-end"><span class="price-pill">@p.Price.ToString("C", za)</span></td>
                            <td>
                                @if (string.IsNullOrWhiteSpace(p.ImageName))
                                {
                                    <span class="text-muted-2">—</span>
                                }
                                else
                                {
                                    <img src="@Url.Action("Image","Products", new { id = p.ImageName })"
                                         alt="@p.Name" class="thumb" />
                                }
                            </td>
                        </tr>
                    }
                </tbody>
            </table>
        </div>
    }
</section>
