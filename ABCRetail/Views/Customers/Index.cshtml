@model IEnumerable<ABCRetail.Models.Customer>
@{
    ViewData["Title"] = "Customers";
    var q = ViewBag.Query as string;
    var count = Model?.Count() ?? 0;
}

<section class="container py-4 text-white">
    @if (TempData["err"] != null)
    {
        <div class="alert alert-warning">@TempData["err"]</div>
    }

    <div class="d-flex flex-column flex-lg-row gap-3 align-items-lg-center justify-content-between mb-3">
        <div>
            <h1 class="display-6 mb-0"><i class="bi bi-people-fill me-2"></i>Customer Details</h1>
            <div class="text-muted-2">Manage your customer records</div>
        </div>
        <div class="d-flex gap-2">
            <form class="d-flex" method="get" asp-action="Index">
                <input class="form-control me-2" name="q" value="@(q ?? "")" placeholder="Search name or email…" />
                <button class="btn btn-ghost" type="submit"><i class="bi bi-search"></i></button>
            </form>
            <a asp-action="Create" class="btn cta-btn"><i class="bi bi-person-plus-fill me-2"></i>Add Customer</a>
        </div>
    </div>

    <div class="d-flex gap-3 mb-3">
        <div class="stat">
            <div class="num">@count</div>
            <div class="label"><i class="bi bi-people me-1"></i>Total</div>
        </div>
    </div>

    @if (count == 0)
    {
        <div class="feature-card p-4 text-center">
            <i class="bi bi-people display-6 d-block mb-2"></i>
            <div class="fs-5">No customers yet</div>
            <div class="text-muted-2 mb-3">Click “Add Customer” to create your first record.</div>
            <a asp-action="Create" class="btn cta-btn"><i class="bi bi-plus-lg me-2"></i>Add Customer</a>
        </div>
    }
    else
    {
        <div class="table-responsive">
            <table class="table align-middle text-white">
                <thead>
                    <tr>
                        <th>Customer</th>
                        <th>Email</th>
                        <th>Address</th>
                        <th>File</th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var c in Model)
                    {
                        var f = c.FirstName ?? string.Empty;
                        var l = c.LastName ?? string.Empty;
                        var initials = $"{(f.Length > 0 ? f[0].ToString() : "")}{(l.Length > 0 ? l[0].ToString() : "")}";
                        <tr class="table-row-elevated">
                            <td>
                                <div class="d-flex align-items-center gap-3">
                                    <div class="avatar">@initials</div>
                                    <div class="fw-bold">@($"{f} {l}".Trim())</div>
                                </div>
                            </td>
                            <td><i class="bi bi-envelope me-1"></i>@(c.Email ?? "-")</td>
                            <td>
                                @if (string.IsNullOrWhiteSpace(c.Address))
                                {
                                    <span class="text-muted-2">—</span>
                                }
                                else
                                {
                                    <span><i class="bi bi-geo-alt me-1"></i>@c.Address</span>
                                }
                            </td>
                            <td>
                                @if (string.IsNullOrWhiteSpace(c.AttachmentName))
                                {
                                    <span class="text-muted-2">—</span>
                                }
                                else
                                {
                                    <a asp-action="File"
                                       asp-route-id="@c.RowKey"
                                       class="btn btn-sm btn-ghost"
                                       title="Download file">
                                        <i class="bi bi-paperclip me-1"></i>@c.AttachmentName
                                    </a>
                                }
                            </td>
                        </tr>
                    }
                </tbody>
            </table>
        </div>
    }
</section>
